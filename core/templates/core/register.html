{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Register Patient | NeuroVista</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#0b1b2e;
      --text:#e6f0ff;
      --muted:#9fb7d7;
      --accent:#3aa0ff;
      --glass: rgba(14,34,58,.42);
      --glass-border: rgba(255,255,255,.18);
    }
    html,body{ height:100%; margin:0; }
    body{
      background: radial-gradient(1200px 800px at 75% 40%, #112b46 0%, var(--ink) 60%) fixed;
      color: var(--text);
      font-family: 'Open Sans', sans-serif;
    }

    .bg-brain::before{
      content:""; position:fixed; inset:0; z-index:-1;
      background:
        linear-gradient(90deg, rgba(11,27,46,.92) 0%, rgba(11,27,46,.82) 40%, rgba(11,27,46,.2) 75%, rgba(11,27,46,0) 100%),
        url("{% static 'img/brain_bg.jpg' %}") right center / cover no-repeat;
    }

    .nv-shell{ min-height:100dvh; display:grid; place-items:center; padding: 32px 16px; }
    .nv-card{
      width:min(760px, 92vw);
      background: var(--glass);
      backdrop-filter: blur(8px);
      border: 1px solid var(--glass-border);
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      padding: clamp(22px, 3.2vw, 34px);
    }

    .nv-title{
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      letter-spacing: .5px;
      color: #e6f0ff;
      margin: 0;
    }
    .nv-subtle{ color: var(--muted); }

    .header-row{
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px;
    }
    .logo-chip{
      width:40px; height:40px; display:grid; place-items:center;
      border-radius: 12px; color:#fff;
      background: linear-gradient(135deg, #62a3ff 0%, #b689ff 100%);
      box-shadow: 0 10px 24px rgba(98,163,255,.22);
      font-size: 1.1rem;
    }

    .form-label{ color:#cfe3ff; font-weight:600; }
    .form-control, .form-select{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.18);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
    }
    .form-control::file-selector-button{
      border: none; background: rgba(255,255,255,.12); color: var(--text);
      padding: 8px 12px; margin-right: 10px; border-radius: 10px; cursor:pointer;
    }
    .form-control:focus, .form-select:focus{
      border-color: rgba(58,160,255,.5);
      box-shadow: 0 0 0 4px rgba(58,160,255,.25);
      background: rgba(255,255,255,.09);
      color: var(--text);
    }
    .helptext, .text-danger.small{ color:#ffd6dc !important; }
    .btn-nv{ border-radius:12px !important; padding:12px 16px !important; font-weight:700; }
    .btn-nv-primary{
      background: var(--accent); border:1px solid var(--accent);
      box-shadow: 0 6px 18px rgba(58,160,255,.22);
      color:#061320;
    }
    .btn-nv-ghost{ color: var(--text); border:1px solid rgba(255,255,255,.35); background: transparent; }
    .btn-nv-ghost:hover{ background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.55); }
    .upload-status{
      display:none; align-items:center; gap:8px; font-size:.95rem; margin-top:6px;
      color: var(--muted);
    }
    .upload-status .dot{
      width:10px; height:10px; border-radius:50%;
      background: #9fb7d7;
    }
    .upload-status.ok .dot{ background: #4ade80; }
    .alert-danger{
      background: rgba(255, 107, 129, .12);
      border: 1px solid rgba(255, 107, 129, .35);
      color: #ffd7de;
      border-radius: 12px;
    }
  </style>
</head>
<body class="bg-brain">

<div class="nv-shell">
  <div class="nv-card">
    <div class="header-row">
      <div class="d-flex align-items-center gap-2">
        <div class="logo-chip">üß†</div>
        <h2 class="nv-title">Register Patient</h2>
      </div>
      <a href="{% url 'home' %}" class="btn btn-nv btn-nv-ghost">‚Üê Home</a>
    </div>
    <p class="nv-subtle mb-3">Provide patient details and upload an MRI to start the analysis.</p>

    {% if error %}
      <div class="alert alert-danger" role="alert">
        {{ error }}
        <form method="get" class="mt-2">
          <button type="submit" class="btn btn-sm btn-nv btn-nv-ghost">üîÑ Try Again</button>
        </form>
      </div>
    {% endif %}

    <form method="POST" enctype="multipart/form-data" id="registerForm" class="row g-3">
      {% csrf_token %}

      {% for field in form %}
        <div class="col-md-6">
          <label class="form-label" for="{{ field.id_for_label }}">{{ field.label }}</label>
          {{ field }}
          {% if field.name == "mri_image" %}
            <div class="upload-status" id="uploadStatus"><span class="dot"></span><span>Uploading‚Ä¶</span></div>
            <div class="upload-status ok" id="uploadSuccess"><span class="dot"></span><span>Image loaded. Ready to analyze.</span></div>
          {% endif %}
          {% if field.errors %}
            <div class="text-danger small mt-1">{{ field.errors }}</div>
          {% endif %}
        </div>
      {% endfor %}

      <div class="col-12 d-flex gap-2 pt-2">
        <button type="submit" class="btn btn-nv btn-nv-primary">üîç Analyze MRI</button>
      </div>
    </form>
  </div>
</div>

<script>
  const imageInput = document.getElementById('id_mri_image');
  const uploadStatus = document.getElementById('uploadStatus');
  const uploadSuccess = document.getElementById('uploadSuccess');

  if (imageInput) {
    imageInput.addEventListener('change', () => {
      if (!imageInput.files || imageInput.files.length === 0) return;
      uploadStatus.style.display = 'flex';
      uploadSuccess.style.display = 'none';
      setTimeout(() => {
        uploadStatus.style.display = 'none';
        uploadSuccess.style.display = 'flex';
      }, 1200);
    });
  }
</script>

</body>
</html>
